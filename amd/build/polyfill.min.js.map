{"version":3,"file":"polyfill.min.js","sources":["../src/polyfill.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Helper functions that come from the theme.js of the TinyMCE and that are\n * heavily used by the colorswat.js.\n *\n * @module      tiny_bfhfontcolor\n * @copyright   2023 Luca BÃ¶sch <luca.boesch@bfh.ch>\n * @copyright   2023 Stephan Robotta <stephan.robotta@bfh.ch>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nexport const hasProto = (v, constructor, predicate) => {\n  if (predicate(v, constructor.prototype)) {\n    return true;\n  } else {\n    return v.constructor?.name === constructor.name;\n  }\n};\nexport const typeOf = x => {\n  const t = typeof x;\n  if (x === null) {\n    return 'null';\n  } else if (t === 'object' && Array.isArray(x)) {\n    return 'array';\n  } else if (t === 'object' && hasProto(x, String, (o, proto) => proto.isPrototypeOf(o))) {\n    return 'string';\n  } else {\n    return t;\n  }\n};\nexport const eq$1 = t => a => t === a;\nexport const isType$1 = type => value => typeOf(value) === type;\nexport const isString = isType$1('string');\nexport const isArray = isType$1('array');\nexport const isUndefined = eq$1(undefined);\nexport const isNullable = a => a === null || a === undefined;\nexport const isNonNullable = a => !isNullable(a);\nexport const isArrayOf = (value, pred) => {\n  if (isArray(value)) {\n    for (let i = 0, len = value.length; i < len; ++i) {\n      if (!pred(value[i])) {\n        return false;\n      }\n    }\n    return true;\n  }\n  return false;\n};\nexport const nativeIndexOf = Array.prototype.indexOf;\nexport const rawIndexOf = (ts, t) => nativeIndexOf.call(ts, t);\nexport const indexOf = (xs, x) => {\n  const r = rawIndexOf(xs, x);\n  return r === -1 ? Optional.none() : Optional.some(r);\n};\nexport const noop = () => {\n  // Do nothing.\n};\n\nexport const contains$1 = (str, substr, start = 0, end) => {\n  const idx = str.indexOf(substr, start);\n  if (idx !== -1) {\n    return isUndefined(end) ? true : idx + substr.length <= end;\n  } else {\n    return false;\n  }\n};\nexport const removeFromStart = (str, numChars) => {\n  return str.substring(numChars);\n};\n\nexport const toHex = component => {\n  const hex = component.toString(16);\n  return (hex.length === 1 ? '0' + hex : hex).toUpperCase();\n};\nexport const fromRgba = rgbaColour => {\n  const value = toHex(rgbaColour.red) + toHex(rgbaColour.green) + toHex(rgbaColour.blue);\n  return hexColour(value);\n};\nexport const rgbRegex = /^\\s*rgb\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)\\s*$/i;\nexport const rgbaRegex = /^\\s*rgba\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?(?:\\.\\d+)?)\\s*\\)\\s*$/i;\nexport const fromStringValues = (red, green, blue, alpha) => {\n  const r = parseInt(red, 10);\n  const g = parseInt(green, 10);\n  const b = parseInt(blue, 10);\n  const a = parseFloat(alpha);\n  return rgbaColour(r, g, b, a);\n};\nexport const fromString = rgbaString => {\n  if (rgbaString === 'transparent') {\n    return Optional.some(rgbaColour(0, 0, 0, 0));\n  }\n  const rgbMatch = rgbRegex.exec(rgbaString);\n  if (rgbMatch !== null) {\n    return Optional.some(fromStringValues(rgbMatch[1], rgbMatch[2], rgbMatch[3], '1'));\n  }\n  const rgbaMatch = rgbaRegex.exec(rgbaString);\n  if (rgbaMatch !== null) {\n    return Optional.some(fromStringValues(rgbaMatch[1], rgbaMatch[2], rgbaMatch[3], rgbaMatch[4]));\n  }\n  return Optional.none();\n};\nexport const removeLeading = (str, prefix) => {\n  return startsWith(str, prefix) ? removeFromStart(str, prefix.length) : str;\n};\n\nexport const checkRange = (str, substr, start) =>\n  substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;\n\nexport const hexColour = value => ({value});\nexport const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\nexport const longformRegex = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i;\nexport const isHexString = hex => shorthandRegex.test(hex) || longformRegex.test(hex);\nexport const normalizeHex = hex => removeLeading(hex, '#').toUpperCase();\nexport const fromString$1 = hex => isHexString(hex) ? Optional.some({value: normalizeHex(hex)}) : Optional.none();\nexport const startsWith = (str, prefix) => {\n  return checkRange(str, prefix, 0);\n};\nexport const anyToHex = color => fromString$1(color).orThunk(() => fromString(color).map(fromRgba)).getOrThunk(() => {\n  const canvas = document.createElement('canvas');\n  canvas.height = 1;\n  canvas.width = 1;\n  const canvasContext = canvas.getContext('2d');\n  canvasContext.clearRect(0, 0, canvas.width, canvas.height);\n  canvasContext.fillStyle = '#FFFFFF';\n  canvasContext.fillStyle = color;\n  canvasContext.fillRect(0, 0, 1, 1);\n  const rgba = canvasContext.getImageData(0, 0, 1, 1).data;\n  const r = rgba[0];\n  const g = rgba[1];\n  const b = rgba[2];\n  const a = rgba[3];\n  return fromRgba(rgbaColour(r, g, b, a));\n});\nexport const rgbaColour = (red, green, blue, alpha) => ({\n  red,\n  green,\n  blue,\n  alpha\n});\n\nexport const mapColors = colorMap => {\n  const colors = [];\n  for (let i = 0; i < colorMap.length; i += 2) {\n    colors.push({\n      text: colorMap[i + 1],\n      value: '#' + anyToHex(colorMap[i]).value,\n      type: 'choiceitem'\n    });\n  }\n  return colors;\n};\n\nexport class Optional {\n  constructor(tag, value) {\n    this.tag = tag;\n    this.value = value;\n  }\n\n  static some(value) {\n    return new Optional(true, value);\n  }\n\n  static none() {\n    return Optional.singletonNone;\n  }\n\n  fold(onNone, onSome) {\n    if (this.tag) {\n      return onSome(this.value);\n    } else {\n      return onNone();\n    }\n  }\n\n  isSome() {\n    return this.tag;\n  }\n\n  isNone() {\n    return !this.tag;\n  }\n\n  map(mapper) {\n    if (this.tag) {\n      return Optional.some(mapper(this.value));\n    } else {\n      return Optional.none();\n    }\n  }\n\n  bind(binder) {\n    if (this.tag) {\n      return binder(this.value);\n    } else {\n      return Optional.none();\n    }\n  }\n\n  exists(predicate) {\n    return this.tag && predicate(this.value);\n  }\n\n  forall(predicate) {\n    return !this.tag || predicate(this.value);\n  }\n\n  filter(predicate) {\n    if (!this.tag || predicate(this.value)) {\n      return this;\n    } else {\n      return Optional.none();\n    }\n  }\n\n  getOr(replacement) {\n    return this.tag ? this.value : replacement;\n  }\n\n  or(replacement) {\n    return this.tag ? this : replacement;\n  }\n\n  getOrThunk(thunk) {\n    return this.tag ? this.value : thunk();\n  }\n\n  orThunk(thunk) {\n    return this.tag ? this : thunk();\n  }\n\n  getOrDie(message) {\n    if (!this.tag) {\n      throw new Error(message ?? 'Called getOrDie on None');\n    } else {\n      return this.value;\n    }\n  }\n\n  static from(value) {\n    return isNonNullable(value) ? Optional.some(value) : Optional.none();\n  }\n\n  getOrNull() {\n    return this.tag ? this.value : null;\n  }\n\n  getOrUndefined() {\n    return this.value;\n  }\n\n  each(worker) {\n    if (this.tag) {\n      worker(this.value);\n    }\n  }\n\n  toArray() {\n    return this.tag ? [this.value] : [];\n  }\n\n  toString() {\n    return this.tag ? `some(${this.value})` : 'none()';\n  }\n}\n\nOptional.singletonNone = new Optional(false);"],"names":["hasProto","v","constructor","predicate","prototype","_v$constructor","name","_exports","typeOf","x","t","Array","isArray","String","o","proto","isPrototypeOf","eq$1","a","isType$1","type","value","isString","isUndefined","undefined","isNullable","isNonNullable","isArrayOf","pred","i","len","length","nativeIndexOf","indexOf","rawIndexOf","ts","call","xs","r","Optional","none","some","noop","contains$1","str","substr","start","arguments","end","idx","removeFromStart","numChars","substring","toHex","component","hex","toString","toUpperCase","fromRgba","rgbaColour","red","green","blue","hexColour","rgbRegex","rgbaRegex","fromStringValues","alpha","parseInt","g","b","parseFloat","fromString","rgbaString","rgbMatch","exec","rgbaMatch","removeLeading","prefix","startsWith","checkRange","shorthandRegex","longformRegex","isHexString","test","normalizeHex","fromString$1","anyToHex","color","orThunk","map","getOrThunk","canvas","document","createElement","height","width","canvasContext","getContext","clearRect","fillStyle","fillRect","rgba","getImageData","data","mapColors","colorMap","colors","push","text","tag","this","static","singletonNone","fold","onNone","onSome","isSome","isNone","mapper","bind","binder","exists","forall","filter","getOr","replacement","or","thunk","getOrDie","message","Error","getOrNull","getOrUndefined","each","worker","toArray","concat"],"mappings":"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"}